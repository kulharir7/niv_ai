<div class="niv-chat-container">
    <div class="niv-sidebar">
        <div class="niv-sidebar-header">
            <button class="btn btn-new-chat">
                <i class="fa fa-plus"></i>
                <span>New Chat</span>
            </button>
            <button class="btn btn-close-sidebar" title="Close sidebar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/></svg>
            </button>
        </div>
        <div class="niv-sidebar-search">
            <i class="fa fa-search niv-search-icon"></i>
            <input type="text" placeholder="Search conversations..." />
        </div>
        <div class="niv-conversation-list"></div>
        <div class="niv-sidebar-footer">
            <div class="niv-token-status">
                <div class="niv-token-icon" style="font-size: 20px; margin-right: 12px;">ðŸª™</div>
                <div class="niv-token-details">
                    <div class="niv-token-usage-label">Token Usage</div>
                    <div class="niv-token-usage-value">-- / --</div>
                </div>
            </div>
            <div class="niv-user-profile">
                <div class="niv-user-avatar"></div>
                <span class="niv-user-name"></span>
                <button class="btn-settings-toggle" title="Settings">
                    <i class="fa fa-cog"></i>
                </button>
            </div>
        </div>
        <div class="niv-sidebar-backdrop" style="display:none;"></div>
        <div class="niv-settings-overlay" style="display:none;"></div>
        <div class="niv-settings-panel" style="display:none;">
            <div class="niv-settings-layout">
                <div class="niv-settings-sidebar">
                    <div class="niv-settings-sidebar-title">Settings</div>
                    <button class="niv-settings-nav-item active" data-settings-tab="general"><i class="fa fa-sliders"></i> General</button>
                    <button class="niv-settings-nav-item" data-settings-tab="appearance"><i class="fa fa-paint-brush"></i> Appearance</button>
                    <button class="niv-settings-nav-item" data-settings-tab="capabilities"><i class="fa fa-code"></i> Capabilities</button>
                    <button class="niv-settings-nav-item" data-settings-tab="connectors"><i class="fa fa-plug"></i> Connectors</button>
                    <button class="niv-settings-nav-item" data-settings-tab="usage"><i class="fa fa-bar-chart"></i> Usage</button>
                </div>
                <div class="niv-settings-main">
                    <div class="niv-settings-header">
                        <span class="niv-settings-title">Niv Chat Settings</span>
                        <button class="btn-settings-close"><i class="fa fa-times"></i></button>
                    </div>
                    <div class="niv-settings-header-line"></div>
                    <div class="niv-settings-body">
                        <div class="niv-settings-tab-content" data-settings-content="general">
                            <div class="niv-settings-section niv-settings-section-credits">
                                <div class="niv-settings-section-title">
                                    <i class="fa fa-diamond niv-settings-section-icon"></i> Credits
                                </div>
                                <div class="niv-settings-credits-row">
                                    <div class="niv-settings-credit-info">
                                        <span class="niv-settings-credit-icon">ðŸ’Ž</span>
                                        <span class="credit-amount">--</span>
                                        <span class="credit-label">credits remaining</span>
                                    </div>
                                    <button class="btn btn-sm btn-recharge" onclick="frappe.set_route(&quot;niv-credits&quot;);">Recharge</button>
                                </div>
                                <div class="niv-low-balance-warning" style="display:none;">
                                    <i class="fa fa-exclamation-triangle"></i>
                                    <span>Low balance! <a href="#" class="recharge-link">Recharge now</a></span>
                                </div>
                            </div>
                            <div class="niv-settings-section niv-settings-section-model">
                                <div class="niv-settings-section-title">
                                    <i class="fa fa-microchip niv-settings-section-icon"></i> Model
                                </div>
                                <div class="niv-settings-section-desc">Choose the AI model for your conversations</div>
                                <div class="niv-sidebar-model-selector">
                                    <button class="niv-sidebar-model-btn" title="Change model">
                                        <span class="sidebar-model-icon">âœ¦</span>
                                        <span class="sidebar-model-text">Default Model</span>
                                        <i class="fa fa-chevron-down sidebar-model-chevron"></i>
                                    </button>
                                    <div class="niv-sidebar-model-popover" style="display:none;">
                                        <div class="sidebar-model-popover-list"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="niv-settings-tab-content" data-settings-content="appearance" style="display:none;">
                            <div class="niv-settings-section niv-settings-section-appearance">
                                <div class="niv-settings-section-title">
                                    <i class="fa fa-paint-brush niv-settings-section-icon"></i> Appearance
                                </div>
                                <div class="niv-settings-card">
                                    <div class="niv-settings-card-label">Theme</div>
                                    <div class="niv-theme-selector">
                                        <div class="niv-theme-dot active" data-theme-id="default" title="Default (Purple)"></div>
                                        <div class="niv-theme-dot" data-theme-id="ocean" title="Ocean (Blue)"></div>
                                        <div class="niv-theme-dot" data-theme-id="forest" title="Forest (Green)"></div>
                                        <div class="niv-theme-dot" data-theme-id="sunset" title="Sunset (Orange)"></div>
                                        <div class="niv-theme-dot" data-theme-id="rose" title="Rose (Pink)"></div>
                                        <div class="niv-theme-dot" data-theme-id="midnight" title="Midnight (Blue)"></div>
                                    </div>
                                </div>
                                <div class="niv-settings-card niv-settings-row">
                                    <div class="niv-settings-card-row-left">
                                        <div class="niv-settings-card-label">Dark Mode</div>
                                        <div class="niv-settings-card-desc">Switch between light and dark themes</div>
                                    </div>
                                    <label class="niv-toggle-switch">
                                        <input type="checkbox" class="btn-dark-mode-toggle" />
                                        <span class="niv-toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="niv-settings-tab-content" data-settings-content="capabilities" style="display:none;">
                            <div class="niv-settings-section niv-settings-row niv-dev-mode-section niv-settings-section-capabilities">
                                <div class="niv-settings-card-row-left">
                                    <div class="niv-settings-section-title" style="margin-bottom:0;">
                                        <i class="fa fa-code niv-settings-section-icon"></i> Developer Mode
                                    </div>
                                    <div class="niv-settings-card-desc">Create DocTypes, scripts, fields directly via AI</div>
                                </div>
                                <label class="niv-toggle-switch">
                                    <input type="checkbox" class="btn-dev-mode-toggle" />
                                    <span class="niv-toggle-slider"></span>
                                </label>
                            </div>
                            <div class="niv-settings-section niv-settings-row">
                                <div class="niv-settings-card-row-left">
                                    <div class="niv-settings-section-title" style="margin-bottom:0;">
                                        <i class="fa fa-users niv-settings-section-icon"></i> Enable A2A (ADK)
                                    </div>
                                    <div class="niv-settings-card-desc">Multi-agent orchestration for complex tasks</div>
                                </div>
                                <label class="niv-toggle-switch">
                                    <input type="checkbox" class="btn-a2a-toggle" />
                                    <span class="niv-toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="niv-settings-tab-content" data-settings-content="connectors" style="display:none;">
                            <div class="niv-settings-section niv-settings-mcp-section niv-settings-section-connectors">
                                <div class="niv-settings-section-title">
                                    <i class="fa fa-plug niv-settings-section-icon"></i> Connectors
                                </div>
                                <div class="niv-settings-section-desc">External tools and MCP servers</div>
                                <div class="niv-mcp-server-list"></div>
                                <a href="/app/niv-mcp-server" class="niv-settings-link-btn niv-mcp-manage-link" onclick="event.preventDefault(); frappe.set_route(&quot;niv-mcp-server&quot;);">
                                    <i class="fa fa-cogs"></i> Manage MCP Servers
                                </a>
                            </div>
                        </div>

                        <div class="niv-settings-tab-content" data-settings-content="usage" style="display:none;">
                            <div class="niv-settings-section niv-settings-section-usage">
                                <button class="btn btn-sm btn-usage-stats niv-settings-link-btn niv-settings-usage-btn">
                                    <i class="fa fa-bar-chart"></i> View Usage Stats
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="niv-voice-overlay" style="display:none;">
        <div class="voice-particles"></div>
        <div class="voice-close-btn" title="Close">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </div>
        <div class="voice-mode-container">
            <div class="voice-orb-wrapper">
                <div class="voice-orb" role="button" tabindex="0">
                    <div class="voice-orb-glow"></div>
                    <div class="voice-orb-inner"></div>
                    <div class="voice-orb-ring ring-1"></div>
                    <div class="voice-orb-ring ring-2"></div>
                    <div class="voice-orb-ring ring-3"></div>
                    <div class="voice-orb-ring ring-4"></div>
                </div>
            </div>
            <div class="voice-status-text">Tap to speak</div>
            <div class="voice-waveform">
                <span class="voice-wave-bar bar-1"></span>
                <span class="voice-wave-bar bar-2"></span>
                <span class="voice-wave-bar bar-3"></span>
                <span class="voice-wave-bar bar-4"></span>
                <span class="voice-wave-bar bar-5"></span>
                <span class="voice-wave-bar bar-6"></span>
                <span class="voice-wave-bar bar-7"></span>
                <span class="voice-wave-bar bar-8"></span>
                <span class="voice-wave-bar bar-9"></span>
            </div>
            <div class="voice-transcript"></div>
            <div class="voice-response-text"></div>
        </div>
        <div class="voice-controls-bar">
            <button class="voice-ctrl-btn voice-mute-btn" title="Mute microphone">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
            </button>
            <button class="voice-ctrl-btn voice-end-btn" title="End conversation">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08a.956.956 0 0 1-.29-.7c0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28a11.27 11.27 0 0 0-2.67-1.85.996.996 0 0 1-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/></svg>
            </button>
            <button class="voice-ctrl-btn voice-speaker-btn" title="Toggle speaker">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
            </button>
        </div>
    </div>
    <div class="niv-main">
        <div class="niv-chat-header">
            <button class="btn btn-sm btn-toggle-sidebar" aria-label="Open sidebar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/></svg>
            </button>
            <div class="niv-header-title">Niv AI</div>
            <!-- Model badge + popover moved to sidebar footer -->
            <div class="niv-model-badge-wrapper" style="display:none;">
                <button class="niv-model-badge" title="Change model">
                    <span class="model-badge-icon">âœ¦</span>
                    <span class="model-badge-text">Default Model</span>
                    <i class="fa fa-chevron-down model-badge-chevron"></i>
                </button>
                <div class="niv-model-popover" style="display:none;">
                    <div class="model-popover-list"></div>
                </div>
            </div>
            <select class="niv-model-dropdown" style="display:none;">
                <option value="">Default Model</option>
            </select>
            <div class="niv-header-actions">
                <button class="btn btn-sm btn-artifacts-toggle" title="Artifacts">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3 7h7l-5.5 4.2L18.5 21 12 16.8 5.5 21l2-7.8L2 9h7z"/></svg>
                </button>
                <button class="btn btn-sm btn-share-chat" title="Share chat">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                </button>
                <button class="btn btn-sm btn-search-messages" title="Search messages (Ctrl+F)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                </button>
                <button class="btn btn-sm btn-delete-chat" title="Delete">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                </button>
            </div>
        </div>
        <div class="niv-search-bar" style="display:none;">
            <input type="text" class="niv-search-input" placeholder="Search in messages..." />
            <span class="niv-search-count"></span>
            <button class="btn btn-xs btn-search-prev" title="Previous"><i class="fa fa-chevron-up"></i></button>
            <button class="btn btn-xs btn-search-next" title="Next"><i class="fa fa-chevron-down"></i></button>
            <button class="btn btn-xs btn-search-close" title="Close"><i class="fa fa-times"></i></button>
        </div>
        <div class="niv-pinned-section" style="display:none;">
            <div class="niv-pinned-header">
                <i class="fa fa-thumb-tack"></i>
                <span>Pinned Messages</span>
                <button class="btn btn-xs btn-toggle-pinned"><i class="fa fa-chevron-up"></i></button>
            </div>
            <div class="niv-pinned-list"></div>
        </div>
        <div class="niv-chat-messages"></div>
        <div class="niv-artifact-panel" style="display:none;">
            <div class="niv-artifact-header">
                <div class="niv-artifact-header-left">
                    <select class="niv-artifact-select">
                        <option value="">Select artifact...</option>
                    </select>
                </div>
                <div class="niv-artifact-header-right">
                    <button class="btn btn-xs btn-artifact-fullscreen" title="Fullscreen"><i class="fa fa-expand"></i></button>
                    <button class="btn btn-xs btn-artifact-close" title="Close"><i class="fa fa-times"></i></button>
                </div>
            </div>
            <div class="niv-artifact-tabs">
                <button class="niv-artifact-tab active" data-tab="preview">Preview</button>
                <button class="niv-artifact-tab" data-tab="code">Code</button>
            </div>
            <div class="niv-artifact-content">
                <div class="niv-artifact-tab-content active" data-content="preview">
                    <iframe class="niv-artifact-iframe" sandbox="allow-scripts allow-forms"></iframe>
                </div>
                <div class="niv-artifact-tab-content" data-content="code">
                    <pre class="niv-artifact-code"><code></code></pre>
                </div>
            </div>
            <div class="niv-artifact-footer">
                <button class="btn btn-xs btn-artifact-copy"><i class="fa fa-copy"></i> Copy</button>
                <button class="btn btn-xs btn-artifact-download"><i class="fa fa-download"></i> Download</button>
                <button class="btn btn-xs btn-artifact-new"><i class="fa fa-plus"></i> New</button>
            </div>
        </div>
        <div class="niv-drag-overlay" style="display:none;">
            <div class="drag-overlay-content">
                <i class="fa fa-cloud-upload"></i>
                <span>Drop files here</span>
            </div>
        </div>
        <div class="niv-scroll-bottom" style="display:none;">
            <span class="scroll-unread-badge" style="display:none;">0</span>
            <i class="fa fa-chevron-down"></i>
        </div>
        <div class="niv-input-area">
            <div class="niv-attach-preview" style="display:none;"></div>
            <div class="niv-input-pill">
                <button class="btn btn-attach-file" title="Attach file">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
                </button>
                <textarea class="niv-input-textarea" placeholder="Message Niv AI..." rows="1"></textarea>
                <!-- emoji picker removed -->
                <div class="niv-input-right">
                    <button class="btn btn-voice-input" title="Voice typing">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
                    </button>
                    <button class="btn btn-voice-mode" title="Voice conversation">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg>
                    </button>
                    <button class="btn btn-send" title="Send">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14l-1.41-1.41L13.17 12H8v-2h5.17l-2.58-2.59L12 6l5 5-5 5z" transform="rotate(-90 12 12)"/></svg>
                    </button>
                    <button class="btn btn-stop" title="Stop generation" style="display:none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                    </button>
                </div>
                <input type="file" class="niv-file-input" style="display:none;" multiple
                    accept=".pdf,.xlsx,.xls,.csv,.docx,.txt,.md,.py,.js,.json,.jpg,.jpeg,.png,.gif,.webp" />
            </div>
            <div class="niv-slash-commands" style="display:none;"></div>
            <div class="niv-input-footer">
                Niv AI can make mistakes. Verify important information.
            </div>
        </div>
    </div>
</div>
